{"version":3,"sources":["auth.js","AuthRedirect.jsx","Player.jsx","Layout.jsx","HostPlayer.jsx","ListenerPlayer.jsx","Room.jsx","Create.jsx","ConnectToSession.jsx","Home.jsx","App.jsx","serviceWorker.js","index.js"],"names":["CLIENT_ID","require","config","redirectURL","window","location","origin","getToken","code","a","key","postData","client_id","grant_type","redirect_uri","code_verifier","sessionStorage","getItem","form","URLSearchParams","append","axios","post","res","setItem","data","refresh_token","Date","now","expires_in","access_token","refreshToken","goAuth","redirectTo","getVerifierAndChallenge","hash","href","encodeURIComponent","len","validChars","array","Uint8Array","crypto","getRandomValues","map","x","charCodeAt","length","randomState","String","fromCharCode","apply","pkce_challenge_from_verifier","hashedState","sha256","plain","TextEncoder","encode","createHash","update","digest","base64urlencode","btoa","replace","v","hashed","base64encoded","crypto2","AuthRedirect","urlParams","search","has","auth","get","then","props","history","React","Component","Player","style","width","textAlign","borderRadius","padding","height","overflow","src","coverArtURL","alt","album","paddingBottom","title","artists","item","name","join","secondsToTimeFormat","position","type","id","value","min","max","duration","readOnly","icon","faVolumeMute","volume","onChange","changeVolume","step","faVolumeUp","cursor","playing","faPause","faPlay","hrs","mins","secs","ret","Layout","display","justifyContent","alignItems","background","color","boxShadow","children","bottom","left","transform","to","HostPlayer","state","connected","uri","device_id","hostConnected","connections","viewPlayer","psoCounter","setHostEmitters","refreshInterval","setInterval","connect","player","addListener","e","console","log","connectToPlayer","setState","on","message","error","initializePlayer","Spotify","getOAuthToken","callback","token","expire","loggedIn","catch","error_description","removeItem","match","params","socket","emit","alert","playbackStateObj","put","device_ids","play","headers","Authorization","setVolume","target","spotifyReady","this","onSpotifyWebPlaybackSDKReady","_prevProps","pPSO","ppsoC","track_window","current_track","paused","process","REACT_APP_SUB","timestamp","clearInterval","tickInterval","removeListener","disconnect","onClick","images","url","backgroundColor","marginTop","margin","pos_ms","uris","position_ms","setListenerListeners","pause","once","when","calcPos","pso","sessionId","number","prevState","resume","tick","getCurrentState","Math","abs","seek","io","Room","isHost","flexWrap","Create","hosting","create","bind","session","Boolean","ConnectToSession","useState","setCode","useHistory","onSubmit","push","placeholder","Home","fontSize","letterSpacing","fontWeight","marginLeft","UserContext","createContext","App","Provider","path","exact","component","hostname","ReactDOM","render","StrictMode","document","getElementById","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.35247c2b.chunk.js","sourcesContent":["import axios from \"axios\";\nimport crypto from \"crypto\";\nexport const CLIENT_ID = \"f15b994280f345438a06222ca529dc94\";\n\nrequire(\"dotenv\").config();\n\nlet redirectURL = window.location.origin + \"/auth\";\nexport async function getToken(code) {\n  let postData = {\n    client_id: CLIENT_ID,\n    grant_type: \"authorization_code\",\n    code: code,\n    redirect_uri: redirectURL,\n    code_verifier: window.sessionStorage.getItem(\"hashKey\"),\n  };\n  let form = new URLSearchParams();\n  for (let key in postData) {\n    form.append(key, postData[key]);\n  }\n\n  let res = await axios.post(\"https://accounts.spotify.com/api/token\", form);\n  window.sessionStorage.setItem(\"refresh_token\", res.data.refresh_token);\n  window.sessionStorage.setItem(\n    \"expires_at\",\n    Date.now() + res.data.expires_in * 1000\n  );\n  window.sessionStorage.setItem(\"access_token\", res.data.access_token);\n  return res.data;\n}\n\nexport async function refreshToken(refreshToken) {\n  let postData = {\n    client_id: CLIENT_ID,\n    grant_type: \"refresh_token\",\n    refresh_token: refreshToken,\n  };\n  let form = new URLSearchParams();\n  for (let key in postData) {\n    form.append(key, postData[key]);\n  }\n\n  let res = await axios.post(\"https://accounts.spotify.com/api/token\", form);\n  window.sessionStorage.setItem(\"refresh_token\", res.data.refresh_token);\n  window.sessionStorage.setItem(\n    \"expires_at\",\n    Date.now() + res.data.expires_in * 1000\n  );\n  window.sessionStorage.setItem(\"access_token\", res.data.access_token);\n  return res.data;\n}\n\nexport async function goAuth(redirectTo) {\n  window.sessionStorage.setItem(\"redirectTo\", redirectTo);\n  let hash = await getVerifierAndChallenge(128);\n\n  window.sessionStorage.setItem(\"hashKey\", hash[0]);\n  window.sessionStorage.setItem(\"hashResult\", hash[1]);\n\n  window.location.href = `https://accounts.spotify.com/authorize?client_id=${CLIENT_ID}&response_type=code&redirect_uri=${encodeURIComponent(\n    redirectURL\n  )}&scope=streaming%20user-read-email%20user-read-private%20user-modify-playback-state&code_challenge_method=S256&code_challenge=${\n    hash[1]\n    }`;\n}\n\nexport async function getVerifierAndChallenge(len) {\n  const validChars =\n    \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\n  let array = new Uint8Array(len);\n  window.crypto.getRandomValues(array);\n  array = array.map((x) => validChars.charCodeAt(x % validChars.length));\n  const randomState = String.fromCharCode.apply(null, array);\n  const hashedState = await pkce_challenge_from_verifier(randomState);\n\n  return [randomState, hashedState];\n}\n\nwindow.crypto2 = crypto;\nfunction sha256(plain) {\n  // returns promise ArrayBuffer\n  const encoder = new TextEncoder();\n  const data = encoder.encode(plain);\n  return crypto.createHash(\"sha256\").update(data).digest();\n}\n\nfunction base64urlencode(a) {\n  // Convert the ArrayBuffer to string using Uint8 array.\n  // btoa takes chars from 0-255 and base64 encodes.\n  // Then convert the base64 encoded to base64url encoded.\n  // (replace + with -, replace / with _, trim trailing =)\n  return btoa(String.fromCharCode.apply(null, new Uint8Array(a)))\n    .replace(/\\+/g, \"-\")\n    .replace(/\\//g, \"_\")\n    .replace(/=+$/, \"\");\n}\n\nasync function pkce_challenge_from_verifier(v) {\n  let hashed = await sha256(v);\n  let base64encoded = base64urlencode(hashed);\n  return base64encoded;\n}\n","import React from \"react\";\nimport * as auth from \"./auth\";\nexport class AuthRedirect extends React.Component {\n  componentDidMount() {\n    const urlParams = new URLSearchParams(window.location.search);\n    if (urlParams.has(\"code\")) {\n      auth.getToken(urlParams.get(\"code\")).then(() => {\n        this.props.history.replace(\n          `/session/${window.sessionStorage.getItem(\"redirectTo\")}`\n        );\n      });\n    }\n  }\n  render() {\n    return <div></div>;\n  }\n}\n","import React from \"react\";\nimport { FontAwesomeIcon as FAI } from \"@fortawesome/react-fontawesome\";\nimport { faPlay, faPause, faVolumeUp, faVolumeMute } from \"@fortawesome/free-solid-svg-icons\";\nexport const Player = (props) => {\n  return (\n    <div\n      style={{\n        width: 300,\n        textAlign: \"center\",\n        borderRadius: 10,\n        padding: 30,\n      }}\n    >\n      <div\n        style={{\n          height: 300,\n          width: 300,\n          overflow: \"hidden\",\n          borderRadius: 10,\n        }}\n      >\n        <img src={props.coverArtURL} alt={`Cover art for ${props.album}`} />\n      </div>\n      <div style={{ paddingBottom: 10 }}>\n        <h3>{props.title}</h3>\n        {props.artists.map((item) => item.name).join(\", \")} <br />\n        {props.album}\n      </div>\n      <div>\n        {secondsToTimeFormat(props.position)}\n        <input\n          style={{ width: \"70%\" }}\n          type=\"range\"\n          name=\"position\"\n          id=\"position\"\n          value={props.position}\n          min={0}\n          max={props.duration}\n          readOnly\n        />\n        {secondsToTimeFormat(props.duration)}\n      </div>\n      <div>\n        <FAI icon={faVolumeMute} />\n        <input\n          type=\"range\"\n          name=\"volume\"\n          id=\"volume\"\n          value={props.volume}\n          onChange={props.changeVolume}\n          min={0}\n          max={1}\n          step={0.01}\n        />\n        <FAI icon={faVolumeUp} />\n      </div>\n      <div style={{ cursor: \"pointer\" }}>\n        {props.playing ? <FAI icon={faPause} /> : <FAI icon={faPlay} />}\n      </div>\n    </div>\n  );\n};\nfunction secondsToTimeFormat(duration) {\n  // Hours, minutes and seconds\n  var hrs = ~~(duration / 3600);\n  var mins = ~~((duration % 3600) / 60);\n  var secs = ~~duration % 60;\n\n  // Output like \"1:01\" or \"4:03:59\" or \"123:03:59\"\n  var ret = \"\";\n\n  if (hrs > 0) {\n    ret += \"\" + hrs + \":\" + (mins < 10 ? \"0\" : \"\");\n  }\n\n  ret += \"\" + mins + \":\" + (secs < 10 ? \"0\" : \"\");\n  ret += \"\" + secs;\n  return ret;\n}\n","import React from \"react\";\nimport PropTypes from 'prop-types';\nimport {Link} from 'react-router-dom';\nimport \"./Layout.css\";\nconst Layout = (props) => {\n  return (\n    <div\n      style={{\n        height: \"100vh\",\n        width: \"100vw\",\n        display: \"flex\",\n        justifyContent: \"center\",\n        alignItems: \"center\"\n      }}\n    >\n      <div\n        style={{\n          background: \"white\",\n          color: \"#2C3A3A\",\n          padding: \"2rem\",\n          borderRadius: \"12.5px\",\n          boxShadow: \"0px 3px 15px rgba(0,0,0,0.2)\",\n        }}\n      >\n        {props.children}\n      </div>\n      <p style={{\n        position: \"absolute\",\n        bottom: \"0\",\n        left: \"50%\",\n        transform: \"translateX(-50%)\",\n        color: 'white'\n      }}>\n        © <a href=\"https://www.pogify.net/\" style={{color: 'white'}}>Pogify</a> 2020 | <Link to=\"tos\" style={{color: 'white'}}>Terms of Service</Link> | <Link to=\"privacy\" style={{color: 'white'}}>Privacy Policy</Link>\n      </p>\n    </div>\n  );\n}\n\nLayout.propTypes = {\n  children: PropTypes.element.isRequired\n};\n\nexport default Layout;\n","import React from \"react\";\nimport * as auth from \"./auth\";\nimport axios from \"axios\";\nimport { Player } from \"./Player\";\nimport Layout from \"./Layout\";\n\nexport default class HostPlayer extends React.Component {\n  state = {\n    position: 0,\n    duration: 0,\n    connected: false,\n    uri: \"\",\n    playing: false,\n    coverArtURL: \"\",\n    title: \"\",\n    artists: [],\n    album: \"\",\n    device_id: \"\",\n    volume: 0.2,\n    hostConnected: false,\n    connections: 0,\n    viewPlayer: false,\n    psoCounter: 0,\n  };\n\n  setHostEmitters = () => {\n    axios.get(\"/refresh\");\n    this.refreshInterval = setInterval(() => {\n      axios.get(\"/refresh\");\n    }, 30 * 60 * 1000);\n  };\n  connect = () => {\n    this.player.addListener(\"ready\", (e) => {\n      console.log(e);\n      this.connectToPlayer(e.device_id);\n      this.setHostEmitters();\n      console.log(window.sessionStorage.getItem(\"expires_at\"));\n\n      this.setState({\n        device_id: e.device_id,\n      });\n    });\n    this.player.addListener(\"not_ready\", console.log);\n    this.player.on(\"initialization_error\", ({ message }) => {\n      console.error(\"Failed to initialize\", message);\n    });\n    this.player.on(\"authentication_error\", ({ message }) => {\n      console.error(\"Failed to authenticate\", message);\n    });\n    this.player.on(\"account_error\", ({ message }) => {\n      console.error(\"Failed to validate Spotify account\", message);\n    });\n    this.player.on(\"playback_error\", ({ message }) => {\n      console.error(\"Failed to perform playback\", message);\n    });\n    this.player.connect();\n  };\n\n  initializePlayer = () => {\n    this.player = new window.Spotify.Player({\n      volume: 0.2,\n      name: \"Pogify Host\",\n      getOAuthToken: (callback) => {\n        let token = window.sessionStorage.getItem(\"access_token\");\n        let refreshToken = window.sessionStorage.getItem(\"refresh_token\");\n        let expire = window.sessionStorage.getItem(\"expires_at\");\n        if (Date.now() > expire && refreshToken) {\n          return auth\n            .refreshToken(refreshToken)\n            .then((data) => {\n              this.setState({\n                loggedIn: true,\n              });\n              callback(data.access_token);\n            })\n            .catch((e) => {\n              if ((e.error_description = \"Refresh Token Revoked\")) {\n                window.sessionStorage.removeItem(\"refresh_token\");\n                window.sessionStorage.removeItem(\"access_token\");\n                auth.goAuth(this.props.match.params.id);\n              }\n            });\n        }\n\n        if (token) {\n          this.setState({\n            loggedIn: true,\n          });\n          return callback(token);\n        }\n        let code = window.sessionStorage.getItem(\"code\");\n        if (code) {\n          auth.getToken(code).then((data) => {\n            window.sessionStorage.removeItem(\"code\");\n            console.log(data);\n            this.setState({\n              loggedIn: true,\n            });\n            callback(data.access_token);\n          });\n        } else {\n          auth.goAuth(this.props.match.params.id);\n        }\n      },\n    });\n    this.player.on(\"player_state_changed\", (data) => {\n      console.log(data);\n      if (this.state.psoCounter && !data) {\n        this.props.socket.emit(\"HOST_DISCONNECT\");\n\n        alert(\n          \"Spotify disconnected. Check that you are connected to the 'Michael Reeves Player' on Spotify\"\n        );\n      }\n      if (data) {\n        console.log(\"alksdfe\", data);\n        this.setState({\n          playbackStateObj: data,\n          position: data.position,\n          psoCounter: this.state.psoCounter + 1,\n        });\n      }\n    });\n  };\n\n  componentDidMount() {\n    if (window.spotifyReady) {\n      this.initializePlayer();\n    } else {\n      window.onSpotifyWebPlaybackSDKReady = this.initializePlayer;\n    }\n  }\n\n  componentDidUpdate(\n    _prevProps,\n    { playbackStateObj: pPSO, psoCounter: ppsoC }\n  ) {\n    if (this.state.psoCounter === 1) {\n      let {\n        track_window: {\n          current_track: { uri },\n        },\n        position,\n        paused,\n      } = this.state.playbackStateObj;\n      console.log(uri);\n      this.props.socket.emit(\"HOST_CONNECTED\", uri, position, !paused);\n    } else if (ppsoC !== this.state.psoCounter) {\n      let {\n        track_window: {\n          current_track: { uri },\n        },\n        position,\n        paused,\n      } = this.state.playbackStateObj;\n      this.props.socket.emit(\"UPDATE\", uri, position, !paused);\n      axios.post(\n        process.env.REACT_APP_SUB + \"/pub\",\n        {\n          timestamp: Date.now(),\n          uri,\n          position,\n          playing: !paused,\n        },\n        {\n          params: {\n            id: \"abc\",\n          },\n        }\n      );\n      if (pPSO.paused !== paused) {\n        if (paused) {\n          clearInterval(this.tickInterval);\n        } else {\n          this.tickInterval = setInterval(() => {\n            this.setState({\n              position: this.state.position + 1000,\n            });\n          }, 1000);\n        }\n      }\n    }\n  }\n\n  componentWillUnmount() {\n    this.player.removeListener(\"ready\");\n    this.props.socket.disconnect();\n    this.player.disconnect();\n    delete window.player;\n  }\n\n  connectToPlayer = (device_id) => {\n    return axios\n      .put(\n        `https://api.spotify.com/v1/me/player`,\n        {\n          device_ids: [device_id || this.state.device_id],\n          play: false,\n        },\n        {\n          headers: {\n            \"Content-Type\": \"application/json\",\n            Authorization: `Bearer ${window.sessionStorage.getItem(\n              \"access_token\"\n            )}`,\n          },\n        }\n      )\n      .then(() => {\n        this.setState({\n          connected: true,\n        });\n      });\n  };\n\n  changeVolume = (e) => {\n    this.player.setVolume(e.target.value);\n    this.setState({\n      volume: e.target.value,\n    });\n  };\n\n  render() {\n    if (Date.now() > window.sessionStorage.getItem(\"expires_at\")) {\n      return (\n        <Layout>\n          <button onClick={this.connect}>Login with Spotify</button>\n        </Layout>\n      );\n    }\n\n    if (!this.state.playbackStateObj) {\n      return (\n        <Layout>\n          <button onClick={this.connect}>Start Session</button>\n        </Layout>\n      );\n    }\n\n    let { paused, duration } = this.state.playbackStateObj;\n    let { volume } = this.state;\n    let position = this.state.position;\n    let coverArtURL = this.state.playbackStateObj.track_window.current_track\n      .album.images[0].url;\n    let album = this.state.playbackStateObj.track_window.current_track.album\n      .name;\n    let artists = this.state.playbackStateObj.track_window.current_track\n      .artists;\n    let title = this.state.playbackStateObj.track_window.current_track.name;\n\n    return (\n      <>\n        <Player\n          position={position / 1000}\n          duration={duration / 1000}\n          coverArtURL={coverArtURL}\n          album={album}\n          title={title}\n          artists={artists}\n          playing={!paused}\n          volume={volume}\n          changeVolume={this.changeVolume}\n        />\n        <div\n          style={{\n            width: 300,\n            textAlign: \"center\",\n            backgroundColor: \"#424242\",\n            borderRadius: 10,\n            padding: 30,\n            marginTop: 10,\n          }}\n        >\n          You are the host of this session. <br />\n          Share the url below to listen with others:\n          <div style={{ margin: 10 }}>\n            <input type=\"text\" readOnly value={window.location.href} />\n          </div>\n          Use Spotify as you usually would. <br />\n          Your music is being played in this browser window. Don't close this\n          window. <br />\n          {this.state.connections} in this session.\n        </div>\n      </>\n    );\n  }\n}\n","import React from \"react\";\nimport * as auth from \"./auth\";\nimport axios from \"axios\";\nimport { Player } from \"./Player\";\nimport Layout from \"./Layout\";\n\nexport default class HostPlayer extends React.Component {\n  state = {\n    hostConnected: false,\n    connected: false,\n    artists: [],\n    position: 0,\n    uri: \"\",\n    duration: 0,\n    volume: 0.2,\n    playing: false,\n    coverArtURL: \"#\",\n    title: \"\",\n    album: \"\",\n    connections: 0,\n  };\n\n  play = (uri, pos_ms) => {\n    console.log(\"play??\", uri, pos_ms);\n    return axios.put(\n      `https://api.spotify.com/v1/me/player/play?device_id=${this.state.device_id}`,\n      {\n        uris: [uri],\n        position_ms: pos_ms,\n      },\n      {\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: `Bearer ${window.sessionStorage.getItem(\n            \"access_token\"\n          )}`,\n        },\n      }\n    );\n  };\n\n  setListenerListeners = () => {\n    this.props.socket.on(\"HOST_DISCONNECT\", () => {\n      this.player.pause();\n      alert(\"Host disconnected. Playback Paused\");\n    });\n\n    this.props.socket.once(\"INITIAL\", (data) => {\n      if (data) {\n        let { uri, position, playing, when } = data;\n        let calcPos = playing ? position + Date.now() - when : position;\n        console.log(\"intial\", uri, position, calcPos, playing, when);\n        this.setState({\n          uri,\n          position: calcPos,\n          playing,\n          hostConnected: true,\n          connected: true,\n        });\n      } else {\n        this.setState({\n          connected: true,\n        });\n      }\n    });\n    this.props.socket.on(\"UPDATE\", (uri, position, playing) => {\n      console.log(\"update\", uri, position, playing);\n      this.setState({\n        uri,\n        position,\n        playing,\n        hostConnected: true,\n      });\n    });\n\n    this.props.socket.on(\"HOST_CONNECTED\", (uri, position, playing) => {\n      console.log(\"host_connected\");\n      this.setState({\n        uri,\n        position,\n        playing,\n        hostConnected: true,\n      });\n    });\n\n    this.player.addListener(\"player_state_changed\", (data) => {\n      console.log(\"player_state_changed\");\n      if (data === null) return;\n\n      this.setState({\n        pso: data,\n      });\n    });\n  };\n\n  async componentDidUpdate(_prevProps, prevState) {\n    if (this.state.hostConnected && this.state.pso) {\n      if (this.state.playing !== !this.state.pso.paused) {\n        if (this.state.playing) {\n          this.player.resume();\n          if (!this.tick) {\n            this.tick = setInterval(() => {\n              this.setState({\n                position: this.state.position + 100,\n              });\n            }, 100);\n          }\n        } else {\n          clearInterval(this.tick);\n          delete this.tick;\n          this.player.pause();\n          this.setState({\n            pso: await this.player.getCurrentState(),\n          });\n        }\n      }\n      if (Math.abs(this.state.position - prevState.position) > 200) {\n        this.player.seek(this.state.position);\n      }\n\n      if (prevState.uri !== this.state.uri) {\n        console.log(\"setTrack\", this.state.uri, this.state.position);\n        this.play(this.state.uri, this.state.position);\n      }\n    }\n  }\n\n  connect = () => {\n    console.log(\"once\");\n    this.player.addListener(\"ready\", (e) => {\n      console.log(e);\n      this.setListenerListeners();\n\n      this.connectToPlayer(e.device_id).then(() => {\n        this.props.socket.emit(\"INITIAL\");\n      });\n      this.setState({\n        device_id: e.device_id,\n      });\n    });\n    this.player.on(\"player_state_changed\", console.log);\n    this.player.on(\"initialization_error\", ({ message }) => {\n      console.error(\"Failed to initialize\", message);\n    });\n    this.player.on(\"authentication_error\", ({ message }) => {\n      console.error(\"Failed to authenticate\", message);\n    });\n    this.player.on(\"account_error\", ({ message }) => {\n      console.error(\"Failed to validate Spotify account\", message);\n    });\n    this.player.on(\"playback_error\", ({ message }) => {\n      console.error(\"Failed to perform playback\", message);\n    });\n    this.player.connect().then(console.log);\n    console.log(\"connect\");\n  };\n\n  componentWillUnmount() {\n    if (this.player) {\n      this.player.disconnect();\n    }\n  }\n\n  initializePlayer = () => {\n    this.player = new window.Spotify.Player({\n      volume: 0.2,\n      name: \"Pogify Listener\",\n      getOAuthToken: (callback) => {\n        let token = window.sessionStorage.getItem(\"access_token\");\n        let refreshToken = window.sessionStorage.getItem(\"refresh_token\");\n        let expire = window.sessionStorage.getItem(\"expires_at\");\n        if (Date.now() > expire && refreshToken) {\n          return auth\n            .refreshToken(refreshToken)\n            .then((data) => {\n              callback(data.access_token);\n            })\n            .catch((e) => {\n              window.sessionStorage.removeItem(\"refresh_token\");\n              window.sessionStorage.removeItem(\"access_token\");\n              auth.goAuth(this.props.sessionId);\n            });\n        }\n\n        if (token) {\n          return callback(token);\n        }\n        let code = window.sessionStorage.getItem(\"code\");\n        if (code) {\n          auth\n            .getToken(code)\n            .then((data) => {\n              window.sessionStorage.removeItem(\"code\");\n              console.log(data);\n              callback(data.access_token);\n            })\n            .catch(() => {\n              auth.goAuth(this.props.sessionId);\n            });\n        } else {\n          auth.goAuth(this.props.sessionId);\n        }\n      },\n    });\n    window.player = this.player;\n    this.props.socket.on(\"CONNECTION_COUNT\", (number) => {\n      console.log(number, \"connections\");\n      this.setState({\n        connections: number,\n      });\n    });\n  };\n\n  componentDidMount() {\n    if (window.spotifyReady) {\n      this.initializePlayer();\n    } else {\n      window.onSpotifyWebPlaybackSDKReady = this.initializePlayer;\n    }\n  }\n\n  connectToPlayer = (device_id) => {\n    return axios.put(\n      `https://api.spotify.com/v1/me/player`,\n      {\n        device_ids: [device_id || this.state.device_id],\n        play: false,\n      },\n      {\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: `Bearer ${window.sessionStorage.getItem(\n            \"access_token\"\n          )}`,\n        },\n      }\n    );\n  };\n\n  changeVolume = (e) => {\n    this.player.setVolume(e.target.value);\n    this.setState({\n      volume: e.target.value,\n    });\n  };\n\n  render() {\n    if (Date.now() > window.sessionStorage.getItem(\"expires_at\")) {\n      return (\n        <Layout>\n          <button onClick={this.connect}>Login with Spotify</button>\n        </Layout>\n      );\n    }\n\n    if (!this.state.connected) {\n      return (\n        <Layout>\n          <button onClick={this.connect}>Join Session</button>\n        </Layout>\n      );\n    }\n\n    if (!this.state.hostConnected) {\n      return (\n        <Layout>\n          <h2>Waiting for Host...</h2>{\" \"}\n          <p>Session Code: {this.props.sessionId}</p>\n        </Layout>\n      );\n    }\n\n    if (!this.state.pso) {\n      return (\n        <Layout>\n          <h2>Pogify Disconnected</h2> <p>Return to home screen</p>\n        </Layout>\n      );\n    }\n    let { paused, duration } = this.state.pso;\n    let volume = this.state.volume;\n    let position = this.state.position;\n    let coverArtURL = this.state.pso.track_window.current_track.album.images[0]\n      .url;\n    let album = this.state.pso.track_window.current_track.album.name;\n    let artists = this.state.pso.track_window.current_track.artists;\n    let title = this.state.pso.track_window.current_track.name;\n\n    return (\n      <Layout>\n        <div>\n          <Player\n            position={position / 1000}\n            duration={duration / 1000}\n            coverArtURL={coverArtURL}\n            album={album}\n            title={title}\n            artists={artists}\n            playing={!paused}\n            volume={volume}\n            changeVolume={this.changeVolume}\n          />\n          <div\n            style={{\n              width: 300,\n              textAlign: \"center\",\n              borderRadius: 10,\n              padding: 30,\n              marginTop: 10,\n            }}\n          >\n            You are listening to session {this.props.sessionId}. <br />\n            Playback is controlled by the host. <br />\n            Pressing pause will pause playback locally only. On resume, playback\n            will resyncronize with the host. <br />\n            {this.state.connections} in this session.\n          </div>\n        </div>\n      </Layout>\n    );\n  }\n}\n","import React from \"react\";\nimport HostPlayer from \"./HostPlayer\";\nimport ListenerPlayer from \"./ListenerPlayer\";\nimport Layout from \"./Layout\"\n\nconst io = window.io;\nexport class Room extends React.Component {\n  state = {\n    isHost: false,\n  };\n\n  componentDidMount() {\n    console.log(\"room mount\");\n\n    this.socket = io(\"/\" + this.props.match.params.id);\n    console.log(\"room mount\");\n    this.socket.on(\"IS_HOST\", (isHost) => {\n      console.log(\"ishost\", isHost);\n      this.setState({\n        isHost,\n      });\n    });\n    this.socket.emit(\"IS_HOST\");\n  }\n\n  componentWillUnmount() {\n    if (this.socket) {\n      this.socket.disconnect();\n    }\n  }\n\n  render() {\n    if (this.socket) {\n      return (\n        <div\n          style={{\n            display: \"flex\",\n            justifyContent: \"space-evenly\",\n            alignItems: \"center\",\n            flexWrap: \"wrap\",\n            height: \"100vh\",\n          }}\n        >\n          {this.state.isHost ? (\n            <HostPlayer {...this.props} socket={this.socket} />\n          ) : (\n              <ListenerPlayer\n                sessionId={this.props.match.params.id}\n                socket={this.socket}\n              />\n            )}\n        </div>\n      );\n    } else {\n      return <Layout><h2>Loading...</h2></Layout>;\n    }\n  }\n}\n","import React from \"react\";\nimport axios from \"axios\";\nimport { Link } from \"react-router-dom\";\nimport Layout from \"./Layout\";\n\nexport class Create extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      hosting: [],\n    };\n    this.create = this.create.bind(this);\n  }\n\n  create() {\n    axios\n      .post(\"/create\", this.state.session, {\n        headers: {\n          \"Content-Type\": \"text/plain\",\n        },\n      })\n      .then((res) => {\n        window.location.href = `/session/${res.data}`;\n        console.log(res.data);\n      })\n      .catch(console.error);\n  }\n\n  componentDidMount() {\n    axios.get(\"/getSessions\").then((res) => {\n      this.setState({\n        hosting: res.data,\n      });\n    });\n  }\n\n  render() {\n    return (\n      <Layout>\n        {Boolean(this.state.hosting.length) && (\n          <div>\n            Your Current Listening Sessions:\n            <ul>\n              {this.state.hosting.map((item) => {\n                return (\n                  <li key={item}>\n                    <Link to={`/session/${item}`} style={{ color: \"unset\" }}>\n                      {item}\n                    </Link>\n                  </li>\n                );\n              })}\n            </ul>\n          </div>\n        )}\n        <button onClick={this.create}>Create New Listening Session</button>\n      </Layout>\n    );\n  }\n}\n","import React from \"react\";\nimport { useHistory } from \"react-router-dom\";\nimport Layout from \"./Layout\";\n\nexport const ConnectToSession = () => {\n  const [code, setCode] = React.useState(\"\");\n  const history = useHistory();\n\n  const submit = () => {\n    history.push(\"/session/\" + code);\n  };\n\n  return (\n    <Layout>\n      <h2>Enter Session Code</h2>\n      <form onSubmit={submit}>\n        <div>\n          <input\n            type=\"text\"\n            placeholder=\"Code\"\n            onChange={(e) => setCode(e.target.value)}\n            style={{\n              width: \"calc(100% - 10px)\",\n              padding: \"5px\"\n            }}\n          />\n        </div>\n        <div>\n          <button type=\"submit\" style={{\n            width: \"100%\",\n            margin: 0,\n            marginTop: \"1rem\"\n          }}>Go to session</button>\n        </div>\n      </form>\n    </Layout>\n  );\n};\n","import React from \"react\";\nimport { Link } from \"react-router-dom\";\nimport Layout from \"./Layout\"\n\nclass Home extends React.Component {\n  render() {\n    return (\n      <Layout>\n        <h1\n          style={{\n            textAlign: \"center\",\n            fontSize: \"5em\",\n            letterSpacing: \"7px\",\n            margin: 0,\n            fontWeight: \"bold\",\n          }}\n        >\n          POGIFY\n          </h1>\n        <div style={{ display: \"flex\", justifyContent: \"space-between\" }}>\n          <Link to=\"/session\">\n            <button>I am a viewer</button>\n          </Link>\n          <Link to=\"/create\">\n            <button style={{ marginLeft: 10}}>I am a streamer</button>\n          </Link>\n        </div>\n      </Layout>\n    );\n  }\n}\n\nexport default Home;\n","import React from \"react\";\nimport { BrowserRouter, Switch, Route } from \"react-router-dom\";\nimport { AuthRedirect } from \"./AuthRedirect\";\nimport { Room } from \"./Room\";\nimport { Create } from \"./Create\";\nimport { ConnectToSession } from \"./ConnectToSession\";\nimport Home from \"./Home\";\nimport \"./App.css\";\n\nconst UserContext = React.createContext({});\nexport const io = window.io;\n\nfunction App() {\n  return (\n    <UserContext.Provider value={{}}>\n      <BrowserRouter>\n        <Switch>\n          <Route path=\"/\" exact component={Home} />\n          <Route path=\"/create\" exact component={Create} />\n          <Route path=\"/auth\" exact component={AuthRedirect} />\n          <Route path=\"/session/:id\" component={Room} />\n          <Route path=\"/session\" component={ConnectToSession} exact />\n          <Route path=\"/\">404</Route>\n        </Switch>\n      </BrowserRouter>\n    </UserContext.Provider>\n  );\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n  // [::1] is the IPv6 localhost address.\n  window.location.hostname === '[::1]' ||\n  // 127.0.0.0/8 are considered localhost for IPv4.\n  window.location.hostname.match(\n    /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n  )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n            'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}