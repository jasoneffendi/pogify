(this.webpackJsonppogify=this.webpackJsonppogify||[]).push([[0],{146:function(e,t,n){e.exports=n(275)},151:function(e,t,n){},152:function(e,t,n){},177:function(e,t){},179:function(e,t){},190:function(e,t){},192:function(e,t){},218:function(e,t){},220:function(e,t){},221:function(e,t){},227:function(e,t){},229:function(e,t){},247:function(e,t){},249:function(e,t){},261:function(e,t){},264:function(e,t){},274:function(e,t,n){},275:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),r=n(139),i=n.n(r),s=(n(151),n(20)),c=(n(152),function(e){return o.a.createElement("div",{style:{height:"100vh",width:"100vw",display:"flex",justifyContent:"center",alignItems:"center"}},o.a.createElement("div",{style:{background:"white",color:"#2C3A3A",padding:"2rem",borderRadius:"12.5px",boxShadow:"0px 3px 15px rgba(0,0,0,0.2)",maxWidth:"90%",maxHeight:"80%",overflow:"auto"}},e.children),o.a.createElement("p",{style:{position:"absolute",bottom:"0",left:"50%",transform:"translateX(-50%)",color:"white"}},"\xa9"," ",o.a.createElement("a",{href:"https://www.pogify.net/",style:{color:"white"}},"Pogify")," ","2020 |"," ",o.a.createElement(s.b,{to:"/tos",style:{color:"white"}},"Terms of Service")," ","|"," ",o.a.createElement(s.b,{to:"/privacy",style:{color:"white"}},"Privacy Policy")))}),l=function(){return o.a.createElement(c,null,o.a.createElement("div",null,o.a.createElement("h1",{id:"privacy-policy"},"Privacy Policy"),o.a.createElement("p",null,"If you require any more information or have any questions about our privacy policy, please feel free to contact us by email at support@pogify.net. At pogify.net, the privacy of our users is extremely important to us. This privacy policy document outlines the types of personal information that are received and collected by pogify.net and how it is used."),o.a.createElement("p",{id:"footnote1"},"1: A verified session is a permanent session granted to an authenticated user"),o.a.createElement("h3",{id:"cookies-and-tokens"},"Cookies and Tokens:"),o.a.createElement("p",null,"Pogify.net does use cookies to store information about visitors sessions, record user-specific information regarding pages the user accesses or visits, customise web page content based on the user's browser type and/or other information that the user sends via his or her browser. Pogify.net stores locally Spotify session tokens and refresh tokens provided when a user uses the Spotify media player. Twitch session tokens and refresh tokens will be stored when a user begins a verified session",o.a.createElement("sup",null,o.a.createElement("a",{href:"#footnote1"},"1")),"."),o.a.createElement("h3",{id:"user-information"},"User information:"),o.a.createElement("p",null,"Pogify.net stores user information collected from Twitch when a user authenticates using Twitch Authentication when creating a verified session",o.a.createElement("sup",null,o.a.createElement("a",{href:"#footnote1"},"1")),". The data collected will include the users channel name. This infomation will only be stored aslong as the verified session is running"),o.a.createElement("h3",{id:"children-under-the-age-of-13"},"Children Under The Age Of 13:"),o.a.createElement("p",null,"Pogify.net is ",o.a.createElement("strong",null,"not")," intended for children under 13 years of age. We do ",o.a.createElement("strong",null,"not")," knowingly collect personal information from children under 13. If you are under 13, please"," ",o.a.createElement("strong",null,"do not")," provide any information on pogify.net."),o.a.createElement("h3",{id:"dispute-resolution"},"Dispute Resolution:"),o.a.createElement("p",null,"If you have any complaints regarding the privacy policy please contact us at support@pogify.net. We will investigate and attempt to resolve complaints and disputes regarding the use of personal information in accordance with the privacy policy."),o.a.createElement("p",null,"The work on the website and the images, logos, text and other such information is the property of Pogify.net ( unless otherwise stated ).")))},u=function(){return o.a.createElement(c,null,o.a.createElement("div",null,o.a.createElement("h1",{id:"terms-and-conditions"},"Terms and Conditions"),o.a.createElement("p",null,"Below are the Terms and Conditions for use of pogify.net. Please read these carefully. By accessing the content of pogify.net you agree to the terms and conditions set out herein and also accept our Privacy Policy. If you do ",o.a.createElement("strong",null,"not")," agree to any of the terms and conditions you should ",o.a.createElement("strong",null,"not")," continue to use pogify.net and leave immediately."),o.a.createElement("p",null,"You agree that you shall ",o.a.createElement("strong",null,"not")," use pogify.net for any illegal purposes and that you will respect all applicable laws and regulations."),o.a.createElement("p",null,"You agree ",o.a.createElement("strong",null,"not")," to use pogify.net in a way that may impair the performance, corrupt or manipulate the content or information available on pogify.net or reduce the overall functionality of pogify.net."),o.a.createElement("p",null,"You agree ",o.a.createElement("strong",null,"not")," to compromise the security of pogify.net or attempt to gain access to secured areas of pogify.net or attempt to access any sensitive information you may believe exist on pogify.net or server where it is hosted."),o.a.createElement("p",null,"You agree to be fully responsible for any claim, expense, losses, liability, costs including legal fees incurred by us arising from any infringement of the terms and conditions in this agreement and to which you will have agreed if you continue to use pogify.net."),o.a.createElement("p",null,"The work on pogify.net and the images, logos, text and other such information is the property of pogify.net ( unless otherwise stated ).")))},p=n(5),d=n(16),h=n(17),m=n(19),f=n(18),y=n(4),g=n.n(y),v=n(8),w=n(21),E=n.n(w),b=n(74),S=n.n(b),_="f15b994280f345438a06222ca529dc94";n(267).config();var k=window.location.origin+"/auth";function O(e){return x.apply(this,arguments)}function x(){return(x=Object(v.a)(g.a.mark((function e(t){var n,a,o,r;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(o in n={client_id:_,grant_type:"authorization_code",code:t,redirect_uri:k,code_verifier:window.sessionStorage.getItem("hashKey")},a=new URLSearchParams,n)a.append(o,n[o]);return e.next=5,E.a.post("https://accounts.spotify.com/api/token",a);case 5:return r=e.sent,window.sessionStorage.setItem("refresh_token",r.data.refresh_token),window.sessionStorage.setItem("expires_at",Date.now()+1e3*r.data.expires_in),window.sessionStorage.setItem("access_token",r.data.access_token),e.abrupt("return",r.data);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(){return(I=Object(v.a)(g.a.mark((function e(t){var n,a,o,r;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(o in n={client_id:_,grant_type:"refresh_token",refresh_token:t},a=new URLSearchParams,n)a.append(o,n[o]);return e.next=5,E.a.post("https://accounts.spotify.com/api/token",a);case 5:return r=e.sent,window.sessionStorage.setItem("refresh_token",r.data.refresh_token),window.sessionStorage.setItem("expires_at",Date.now()+1e3*r.data.expires_in),window.sessionStorage.setItem("access_token",r.data.access_token),e.abrupt("return",r.data);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(e){return T.apply(this,arguments)}function T(){return(T=Object(v.a)(g.a.mark((function e(t){var n;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return window.sessionStorage.setItem("redirectTo",t),e.next=3,A(128);case 3:n=e.sent,window.sessionStorage.setItem("hashKey",n[0]),window.sessionStorage.setItem("hashResult",n[1]),window.location.href="https://accounts.spotify.com/authorize?client_id=".concat(_,"&response_type=code&redirect_uri=").concat(encodeURIComponent(k),"&scope=streaming%20user-read-email%20user-read-private%20user-modify-playback-state&code_challenge_method=S256&code_challenge=").concat(n[1]);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(e){var t=this;return new window.Spotify.Player({volume:.2,name:e,getOAuthToken:function(e){var n=window.sessionStorage.getItem("access_token"),a=window.sessionStorage.getItem("refresh_token"),o=window.sessionStorage.getItem("expires_at");if(Date.now()>o&&a)return function(e){return I.apply(this,arguments)}(n).then((function(t){e(t.access_token)})).catch((function(e){(e.error_description="Refresh Token Revoked")&&(window.sessionStorage.removeItem("refresh_token"),window.sessionStorage.removeItem("access_token"),C(window.location.pathname))}));if(n)return e(n);var r=window.sessionStorage.getItem("code");r?O(r).then((function(n){window.sessionStorage.removeItem("code"),console.log(n),t.setState({loggedIn:!0}),e(n.access_token)})):C(window.location.pathname)}})}function A(e){return j.apply(this,arguments)}function j(){return(j=Object(v.a)(g.a.mark((function e(t){var n,a,o,r;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=new Uint8Array(t),window.crypto.getRandomValues(a),a=a.map((function(e){return n.charCodeAt(e%n.length)})),o=String.fromCharCode.apply(null,a),e.next=7,L(o);case 7:return r=e.sent,e.abrupt("return",[o,r]);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(e){var t=(new TextEncoder).encode(e);return S.a.createHash("sha256").update(t).digest()}function D(e){return btoa(String.fromCharCode.apply(null,new Uint8Array(e))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function L(e){return U.apply(this,arguments)}function U(){return(U=Object(v.a)(g.a.mark((function e(t){var n,a;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R(t);case 2:return n=e.sent,a=D(n),e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}window.crypto2=S.a;var W=function(e){Object(m.a)(n,e);var t=Object(f.a)(n);function n(){return Object(d.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"componentDidMount",value:function(){var e=this,t=new URLSearchParams(window.location.search);t.has("code")&&O(t.get("code")).then((function(){e.props.history.replace(window.sessionStorage.getItem("redirectTo"))}))}},{key:"render",value:function(){return o.a.createElement("div",null)}}]),n}(o.a.Component),B=n(145),K=n(140);function H(){var e=Object(K.a)(["\n  width: calc(100% - 10px);\n  padding: 5px;\n  border-radius: 12px;\n  border-style: solid;\n  border-width: 0.5px;\n  border-color: rgb(44, 58, 58);\n  text-align: center;\n  transition: box-shadow 0.3s;\n\n  &:focus {\n    outline: none;\n    box-shadow: 0 12px 16px 0 rgba(0, 0, 0, 0.24);\n  }\n"]);return H=function(){return e},e}var z=n(141).a.input(H()),N=function(){var e=o.a.useState(""),t=Object(B.a)(e,2),n=t[0],a=t[1],r=Object(p.f)();return o.a.createElement(c,null,o.a.createElement("h2",{style:{marginTop:0}},"Enter Session Code"),o.a.createElement("form",{onSubmit:function(){r.push("/session/"+n)},style:{display:"inline"}},o.a.createElement("div",null,o.a.createElement(z,{type:"text",placeholder:"Code",onChange:function(e){return a(e.target.value)},style:{}})),o.a.createElement("div",null,o.a.createElement("button",{type:"submit",style:{width:"100%",margin:"auto",marginTop:"1rem"}},"Go"))))},F=n(49),V=n(75),Y=(n(272),{apiKey:Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_FIREBASE_API_KEY,authDomain:Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_FIREBASE_AUTH_DOMAIN,projectId:Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_FIREBASE_PROJECT_ID,appId:Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_FIREBASE_APP_ID});V.initializeApp(Y);var M=V.auth(),q=function(){var e=Object(v.a)(g.a.mark((function e(t){var n,a;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,M.signInAnonymously();case 3:return n=e.sent,e.t0=E.a,e.t1=window.localStorage.getItem("pogify:token"),e.next=8,n.user.getIdToken();case 8:return e.t2=e.sent,e.t3="Bearer "+e.t2,e.t4={"X-Session-Token":e.t1,Authorization:e.t3},e.t5={headers:e.t4},e.next=14,e.t0.get.call(e.t0,"https://us-central1-pogify-database.cloudfunctions.net/refreshToken",e.t5);case 14:return a=e.sent,window.localStorage.setItem("pogify:token",a.data.token),window.localStorage.setItem("pogify:expiresAt",1e3*a.data.expiresIn+Date.now()),e.abrupt("return",a.data);case 20:e.prev=20,e.t6=e.catch(0),console.error(e.t6);case 23:case"end":return e.stop()}}),e,null,[[0,20]])})));return function(t){return e.apply(this,arguments)}}(),G=function(){var e=Object(v.a)(g.a.mark((function e(){var t,n=arguments;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:1,e.abrupt("return",new Promise(function(){var e=Object(v.a)(g.a.mark((function e(n,a){var o,r,i;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,M.signInAnonymously();case 3:return o=e.sent,e.t0=E.a,e.t1=void 0,e.next=8,o.user.getIdToken();case 8:return e.t2=e.sent,e.t3="Bearer "+e.t2,e.t4={Authorization:e.t3},e.t5={headers:e.t4},e.next=14,e.t0.post.call(e.t0,"https://us-central1-pogify-database.cloudfunctions.net/startSession",e.t1,e.t5);case 14:r=e.sent,i=r.data,window.localStorage.setItem("pogify:token",i.token),window.localStorage.setItem("pogify:expiresAt",1e3*i.expiresIn+Date.now()),window.localStorage.setItem("pogify:session",i.session),n(i),e.next=27;break;case 22:if(e.prev=22,e.t6=e.catch(0),10!==t){e.next=26;break}return e.abrupt("return",a(new Error("max retries reached")));case 26:setTimeout((function(){n(G(t+1))}),Math.pow(t/10,2));case 27:case"end":return e.stop()}}),e,null,[[0,22]])})));return function(t,n){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),J=function(){var e=Object(v.a)(g.a.mark((function e(t,n,a){var o,r,i=arguments;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=i.length>3&&void 0!==i[3]?i[3]:0,e.prev=1,e.next=4,M.signInAnonymously();case 4:return r=e.sent,e.t0=E.a,e.t1={uri:t,position:n,playing:a,timestamp:Date.now()},e.t2=window.localStorage.getItem("pogify:token"),e.next=10,r.user.getIdToken();case 10:return e.t3=e.sent,e.t4="Bearer "+e.t3,e.t5={"X-Session-Token":e.t2,Authorization:e.t4,"Content-Type":"application/json"},e.t6={headers:e.t5},e.next=16,e.t0.post.call(e.t0,"https://us-central1-pogify-database.cloudfunctions.net/postUpdate",e.t1,e.t6);case 16:e.next=26;break;case 18:if(e.prev=18,e.t7=e.catch(1),e.t7.response&&(401===e.t7.response.status?console.error("sessionExpired"):e.t7.response.status),!(o<3)){e.next=25;break}setTimeout((function(){return J(t,n,a,o+1)}),100),e.next=26;break;case 25:throw e.t7;case 26:case"end":return e.stop()}}),e,null,[[1,18]])})));return function(t,n,a){return e.apply(this,arguments)}}(),X=function(e){Object(m.a)(n,e);var t=Object(f.a)(n);function n(e){var a;return Object(d.a)(this,n),(a=t.call(this,e)).state={activeSession:""},a.create=a.create.bind(Object(F.a)(a)),a}return Object(h.a)(n,[{key:"create",value:function(){var e=Object(v.a)(g.a.mark((function e(){var t;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,G();case 2:t=e.sent,this.props.history.push("/session/"+t.session);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){window.localStorage.getItem("pogify:expiresAt")>Date.now()&&this.setState({activeSession:window.localStorage.getItem("pogify:session")})}},{key:"render",value:function(){return o.a.createElement(c,null,Boolean(this.state.activeSession)&&o.a.createElement("div",{style:{textAlign:"center",margin:5}},"Your Active Session:",o.a.createElement("div",null,o.a.createElement(s.b,{to:"/session/".concat(this.state.activeSession),style:{color:"unset"}},this.state.activeSession))),o.a.createElement("button",{onClick:this.create},"Create New Listening Session"))}}]),n}(o.a.Component),$=function(e){Object(m.a)(n,e);var t=Object(f.a)(n);function n(){return Object(d.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"render",value:function(){return o.a.createElement(c,null,o.a.createElement("h1",{style:{textAlign:"center",fontSize:"5em",letterSpacing:"7px",margin:0,fontWeight:"bold"}},"POGIFY"),o.a.createElement("div",{style:{display:"flex",justifyContent:"space-evenly",marginTop:12}},o.a.createElement(s.b,{to:"/session"},o.a.createElement("button",{style:{fontSize:15}},o.a.createElement("u",null,"Join")," a Session")),o.a.createElement(s.b,{to:"/create"},o.a.createElement("button",{style:{fontSize:15}},o.a.createElement("u",null,"Start")," a session"))))}}]),n}(o.a.Component),Q=n(42),Z=n(43),ee=function(e){return o.a.createElement("div",{style:{width:300,textAlign:"center",borderRadius:10,padding:30}},o.a.createElement("div",{style:{height:300,width:300,overflow:"hidden"}},o.a.createElement("img",{src:e.coverArtURL,alt:"Cover art for ".concat(e.album)})),o.a.createElement("div",{style:{paddingBottom:10}},o.a.createElement("h3",null,e.title),e.artists.map((function(e){return e.name})).join(", ")," ",o.a.createElement("br",null),e.album),o.a.createElement("div",null,te(e.position),o.a.createElement("input",{style:{width:"70%"},type:"range",name:"position",id:"position",value:e.position,min:0,max:e.duration,readOnly:!0}),te(e.duration)),o.a.createElement("div",null,o.a.createElement(Q.a,{icon:Z.c}),o.a.createElement("input",{type:"range",name:"volume",id:"volume",value:e.volume,onChange:e.changeVolume,min:0,max:1,step:.01}),o.a.createElement(Q.a,{icon:Z.d})),!e.dontShow&&o.a.createElement("div",{style:{cursor:"pointer"},onClick:function(){return e.togglePlay()}},e.playing?o.a.createElement(Q.a,{icon:Z.a}):o.a.createElement(Q.a,{icon:Z.b})))};function te(e){var t=~~(e/3600),n=~~(e%3600/60),a=~~e%60,o="";return t>0&&(o+=t+":"+(n<10?"0":"")),o+=n+":"+(a<10?"0":""),o+=""+a}var ne=function(e){Object(m.a)(n,e);var t=Object(f.a)(n);function n(){var e;Object(d.a)(this,n);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))).state={position:0,duration:0,connected:!1,uri:"",playing:!1,coverArtURL:"",title:"",artists:[],album:"",device_id:"",volume:.2,hostConnected:!1,loading:!0,connections:0,viewPlayer:!1,psoCounter:0,session_token:""},e.setTokenRefreshInterval=function(){e.refreshInterval=setInterval(q,18e5,[window.localStorage.getItem("pogify:token")])},e.connect=function(){e.player.addListener("ready",(function(t){console.log(t),e.connectToPlayer(t.device_id),e.setTokenRefreshInterval(),console.log(window.sessionStorage.getItem("expires_at")),e.setState({device_id:t.device_id,loggedIn:!0})})),e.player.addListener("not_ready",console.log),e.player.on("initialization_error",(function(e){var t=e.message;console.error("Failed to initialize",t)})),e.player.on("authentication_error",(function(e){var t=e.message;console.error("Failed to authenticate",t)})),e.player.on("account_error",(function(e){var t=e.message;console.error("Failed to validate Spotify account",t)})),e.player.on("playback_error",(function(e){var t=e.message;console.error("Failed to perform playback",t)})),e.player.connect()},e.initializePlayer=function(){window.spotifyReady=!0,e.player=P("Pogify Host"),e.player.on("player_state_changed",(function(t){console.log(t),e.state.psoCounter&&!t&&(e.publishUpdate("",e.state.position,!1),alert("Spotify disconnected. Check that you are connected to 'Pogify Host' on Spotify")),t&&(console.log("alksdfe",t),e.setState({playbackStateObj:t,position:t.position,psoCounter:e.state.psoCounter+1}))})),e.setState({loading:!1})},e.connectToPlayer=function(t){return E.a.put("https://api.spotify.com/v1/me/player",{device_ids:[t||e.state.device_id],play:!1},{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(window.sessionStorage.getItem("access_token"))}}).then((function(){e.setState({connected:!0})}))},e.changeVolume=function(t){e.player.setVolume(t.target.value),e.setState({volume:t.target.value})},e}return Object(h.a)(n,[{key:"publishUpdate",value:function(){var e=Object(v.a)(g.a.mark((function e(t,n,a){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:J(t,n,a);case 1:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){var e=this;window.onbeforeunload=function(){e.publishUpdate("",e.state.position,!1)},this.setState({session_token:window.localStorage.getItem("pogify:token")}),window.spotifyReady?this.initializePlayer():window.onSpotifyWebPlaybackSDKReady=this.initializePlayer}},{key:"componentDidUpdate",value:function(e,t){var n=this,a=t.playbackStateObj,o=t.psoCounter;if(a&&o!==this.state.psoCounter){var r=this.state.playbackStateObj,i=r.track_window.current_track.uri,s=r.position,c=r.paused;this.publishUpdate(i,s,!c),a.paused!==c&&(c?clearInterval(this.tickInterval):this.tickInterval=setInterval((function(){n.setState({position:n.state.position+1e3})}),1e3))}}},{key:"componentWillUnmount",value:function(){this.publishUpdate("",this.state.position,!1),window.onbeforeunload=null,this.player.disconnect(),clearInterval(this.refreshInterval)}},{key:"render",value:function(){var e=this;if(Date.now()>window.sessionStorage.getItem("expires_at"))return o.a.createElement(c,null,o.a.createElement("button",{onClick:this.connect},"Login with Spotify"));if(this.state.loading)return o.a.createElement(c,null,o.a.createElement("div",null,"Loading"));if(!this.state.playbackStateObj)return o.a.createElement(c,null,o.a.createElement("button",{onClick:this.connect},"Start Session"));var t=this.state.playbackStateObj,n=t.paused,a=t.duration,r=this.state.volume,i=this.state.position,s=this.state.playbackStateObj.track_window.current_track.album.images[0].url,l=this.state.playbackStateObj.track_window.current_track.album.name,u=this.state.playbackStateObj.track_window.current_track.artists,p=this.state.playbackStateObj.track_window.current_track.name;return o.a.createElement(o.a.Fragment,null,o.a.createElement(ee,{position:i/1e3,duration:a/1e3,coverArtURL:s,album:l,title:p,artists:u,togglePlay:function(){return e.player.togglePlay()},playing:!n,volume:r,changeVolume:this.changeVolume}),o.a.createElement("div",{style:{width:300,textAlign:"center",backgroundColor:"#424242",borderRadius:10,padding:30,marginTop:10}},"You are the host of this session. ",o.a.createElement("br",null),"Share the url below to listen with others:",o.a.createElement("div",{style:{margin:10}},o.a.createElement("input",{type:"text",readOnly:!0,value:window.location.href})),"Use Spotify as you usually would. ",o.a.createElement("br",null),"Your music is being played in this browser window. Don't close this window. ",o.a.createElement("br",null),this.state.connections," in this session."))}}]),n}(o.a.Component),ae=function(e){Object(m.a)(n,e);var t=Object(f.a)(n);function n(){var e;Object(d.a)(this,n);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))).playReq=!1,e.state={hostConnected:!1,subConnected:!1,spotConnected:!1,loading:!0,artists:[],position:0,uri:"",duration:0,volume:.2,playing:!1,title:"",album:"",connections:0},e.play=function(t,n){if(!e.playReq)return e.playReq=!0,console.log("play??",t,n),E.a.put("https://api.spotify.com/v1/me/player/play?device_id=".concat(e.state.device_id),{uris:[t],position_ms:n},{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(window.sessionStorage.getItem("access_token"))}}).then((function(){setTimeout((function(){e.playReq=!1}),1e3)}))},e.setListenerListeners=function(){console.log(Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_SUB),e.eventListener=new EventSource(Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_SUB+"/sub/"+e.props.sessionId+".b1"),e.eventListener.onopen=function(){e.setState({subConnected:!0})},e.eventListener.onmessage=function(t){console.log(t.data);var n=JSON.parse(t.data),a=n.timestamp,o=n.uri,r=n.position,i=n.playing;if(console.log(t.data),e.state.uri&&!o)return e.setState({playing:!1}),void alert("Host disconnected. Playback Paused");o?e.setState((function(e){if(e.timestamp&&a<e.timestamp)return{};var t=i?r+Date.now()-a:r;return{timestamp:a,uri:o,position:t,playing:i,hostConnected:!0}})):e.setState({hostConnected:!1})},e.eventListener.onerror=console.error,e.player.addListener("player_state_changed",(function(t){console.log("player_state_changed"),null!==t&&e.setState({pso:t,uri:t.uri,position:t.position,duration:t.duration})}))},e.connect=function(){console.log("once"),e.player.addListener("ready",(function(t){console.log(t),e.setListenerListeners(),e.connectToPlayer(t.device_id).then((function(){console.log("connect"),e.setState({device_id:t.device_id,spotConnected:!0})}))})),e.player.on("player_state_changed",console.log),e.player.on("initialization_error",(function(e){var t=e.message;console.error("Failed to initialize",t)})),e.player.on("authentication_error",(function(e){var t=e.message;console.error("Failed to authenticate",t)})),e.player.on("account_error",(function(e){var t=e.message;console.error("Failed to validate Spotify account",t)})),e.player.on("playback_error",(function(e){var t=e.message;console.error("Failed to perform playback",t)})),e.player.connect().then(console.log)},e.initializePlayer=function(){window.spotifyReady=!0,e.player=P("Pogify Listener"),e.setState({loading:!1})},e.connectToPlayer=function(t){return E.a.put("https://api.spotify.com/v1/me/player",{device_ids:[t||e.state.device_id],play:!1},{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(window.sessionStorage.getItem("access_token"))}})},e.changeVolume=function(t){e.player.setVolume(t.target.value),e.setState({volume:t.target.value})},e}return Object(h.a)(n,[{key:"componentDidUpdate",value:function(){var e=Object(v.a)(g.a.mark((function e(t,n){var a=this;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.state.hostConnected||!this.state.pso){e.next=18;break}if(this.state.playing===!this.state.pso.paused){e.next=16;break}if(!this.state.playing){e.next=7;break}this.player.resume(),this.tick||(this.tick=setInterval((function(){a.setState({position:a.state.position+100})}),100)),e.next=16;break;case 7:return clearInterval(this.tick),delete this.tick,this.player.pause(),e.t0=this,e.next=13,this.player.getCurrentState();case 13:e.t1=e.sent,e.t2={pso:e.t1},e.t0.setState.call(e.t0,e.t2);case 16:Math.abs(this.state.position-n.position)>200&&this.player.seek(this.state.position),n.uri===this.state.uri&&this.state.uri===this.state.pso.uri||!this.state.uri||this.play(this.state.uri,this.state.position);case 18:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){this.eventListener&&this.eventListener.close(),this.player&&this.player.disconnect()}},{key:"componentDidMount",value:function(){window.spotifyReady?this.initializePlayer():window.onSpotifyWebPlaybackSDKReady=this.initializePlayer}},{key:"render",value:function(){var e=this;if(Date.now()>window.sessionStorage.getItem("expires_at"))return o.a.createElement(c,null,o.a.createElement("button",{onClick:this.connect},"Login with Spotify"));if(this.state.loading)return o.a.createElement(c,null,o.a.createElement("div",null,"Loading..."));if(!this.state.spotConnected||!this.state.subConnected)return o.a.createElement(c,null,o.a.createElement("button",{onClick:this.connect},"Join Session"));if(!this.state.hostConnected)return o.a.createElement(c,null,o.a.createElement("h2",null,"Waiting for Host...")," ",o.a.createElement("p",null,"Session Code: ",this.props.sessionId));if(!this.state.pso)return o.a.createElement(c,null,o.a.createElement("h2",null,"Pogify Disconnected")," ",o.a.createElement("p",null,"Return to home screen"));var t=this.state.pso,n=t.paused,a=t.duration,r=this.state.volume,i=this.state.position,s=this.state.pso.track_window.current_track.album.images[0].url,l=this.state.pso.track_window.current_track.album.name,u=this.state.pso.track_window.current_track.artists,p=this.state.pso.track_window.current_track.name;return o.a.createElement(c,null,o.a.createElement("div",{style:{display:"flex",flexWrap:"wrap"}},o.a.createElement(ee,{dontShow:!0,position:i/1e3,duration:a/1e3,coverArtURL:s,album:l,title:p,artists:u,togglePlay:function(){return e.player.togglePlay()},playing:!n,volume:r,changeVolume:this.changeVolume}),o.a.createElement("div",{style:{width:300,textAlign:"center",borderRadius:10,padding:30,marginTop:10}},"You are listening to session ",this.props.sessionId,". ",o.a.createElement("br",null),"Playback is controlled by the host. ",o.a.createElement("br",null),o.a.createElement("deL",null,"Pressing pause will pause playback locally only. On resume, playback will resynchronize with the host. ",o.a.createElement("br",null)),o.a.createElement("h3",null,"Listener Pause/Play is not implemented at the moment. To pause navigate away from this page or disconnect from 'Pogify Listener' from another spotify instance.")," ",o.a.createElement("h1",null,'PRESSING PLAY OR PAUSE ON SPOTIFY WILL NOT CONTROL LOCAL PLAYBACK AS LONG AS YOU ARE CONNECTED TO "POGIFY LISTENER"'),o.a.createElement("br",null),this.state.connections," in this session.")))}}]),n}(o.a.Component),oe=function(e){Object(m.a)(n,e);var t=Object(f.a)(n);function n(){var e;Object(d.a)(this,n);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))).state={isHost:void 0},e}return Object(h.a)(n,[{key:"componentDidMount",value:function(){window.localStorage.getItem("pogify:expiresAt")<Date.now()?this.setState({isHost:null}):this.setState({isHost:window.localStorage.getItem("pogify:session")})}},{key:"componentWillUnmount",value:function(){this.state.expired&&(window.localStorage.removeItem("pogify:expiresAt"),window.localStorage.removeItem("pogify:token"),window.localStorage.removeItem("pogify:session"))}},{key:"render",value:function(){return void 0!==this.state.isHost?o.a.createElement("div",{style:{display:"flex",justifyContent:"space-evenly",alignItems:"center",flexWrap:"wrap",height:"100vh"}},this.state.isHost===this.props.match.params.id?o.a.createElement(ne,Object.assign({},this.props,{sessionId:this.props.match.params.id})):o.a.createElement(ae,{sessionId:this.props.match.params.id})):o.a.createElement(c,null,o.a.createElement("h2",null,"Loading..."))}}]),n}(o.a.Component);n(274);var re=function(){return o.a.createElement(s.a,null,o.a.createElement(p.c,null,o.a.createElement(p.a,{path:"/",exact:!0,component:$}),o.a.createElement(p.a,{path:"/create",exact:!0,component:X}),o.a.createElement(p.a,{path:"/auth",exact:!0,component:W}),o.a.createElement(p.a,{path:"/session/:id",component:oe}),o.a.createElement(p.a,{path:"/session",component:N,exact:!0}),o.a.createElement(p.a,{path:"/privacy",component:l}),o.a.createElement(p.a,{path:"/tos",component:u}),o.a.createElement(p.a,{path:"/"},o.a.createElement(c,null,o.a.createElement("div",{style:{textAlign:"center"}},o.a.createElement("h1",{style:{margin:0}},o.a.createElement("div",null,"404")),o.a.createElement("div",null,"What you are looking for ain't here"),o.a.createElement(s.b,{to:"/"},"Go home"))))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(re,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[146,1,2]]]);
//# sourceMappingURL=main.808f79f3.chunk.js.map